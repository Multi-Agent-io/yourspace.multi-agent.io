import{w as j,v as P,a as z}from"./runtime-dom.esm-bundler.BEzqyxp1.js";import{c as g,o as b,d as $,a as i,b as J,w as k,e as S,t as Q,n as W,r as m,f as G,g as Y}from"./runtime-core.esm-bundler.mmfGiYl5.js";/* empty css                          */import{_ as X}from"./_plugin-vue_export-helper.DlAUqK2U.js";class y{constructor(t=0,s="Network Error"){this.status=t,this.text=s}}const Z=()=>{if(!(typeof localStorage>"u"))return{get:e=>Promise.resolve(localStorage.getItem(e)),set:(e,t)=>Promise.resolve(localStorage.setItem(e,t)),remove:e=>Promise.resolve(localStorage.removeItem(e))}},n={origin:"https://api.emailjs.com",blockHeadless:!1,storageProvider:Z()},R=e=>e?typeof e=="string"?{publicKey:e}:e.toString()==="[object Object]"?e:{}:{},ee=(e,t="https://api.emailjs.com")=>{if(!e)return;const s=R(e);n.publicKey=s.publicKey,n.blockHeadless=s.blockHeadless,n.storageProvider=s.storageProvider,n.blockList=s.blockList,n.limitRate=s.limitRate,n.origin=s.origin||t},I=async(e,t,s={})=>{const r=await fetch(n.origin+e,{method:"POST",headers:s,body:t}),o=await r.text(),l=new y(r.status,o);if(r.ok)return l;throw l},T=(e,t,s)=>{if(!e||typeof e!="string")throw"The public key is required. Visit https://dashboard.emailjs.com/admin/account";if(!t||typeof t!="string")throw"The service ID is required. Visit https://dashboard.emailjs.com/admin";if(!s||typeof s!="string")throw"The template ID is required. Visit https://dashboard.emailjs.com/admin/templates"},te=e=>{if(e&&e.toString()!=="[object Object]")throw"The template params have to be the object. Visit https://www.emailjs.com/docs/sdk/send/"},V=e=>e.webdriver||!e.languages||e.languages.length===0,H=()=>new y(451,"Unavailable For Headless Browser"),se=(e,t)=>{if(!Array.isArray(e))throw"The BlockList list has to be an array";if(typeof t!="string")throw"The BlockList watchVariable has to be a string"},re=e=>!e.list?.length||!e.watchVariable,ie=(e,t)=>e instanceof FormData?e.get(t):e[t],B=(e,t)=>{if(re(e))return!1;se(e.list,e.watchVariable);const s=ie(t,e.watchVariable);return typeof s!="string"?!1:e.list.includes(s)},O=()=>new y(403,"Forbidden"),oe=(e,t)=>{if(typeof e!="number"||e<0)throw"The LimitRate throttle has to be a positive number";if(t&&typeof t!="string")throw"The LimitRate ID has to be a non-empty string"},ae=async(e,t,s)=>{const r=Number(await s.get(e)||0);return t-Date.now()+r},D=async(e,t,s)=>{if(!t.throttle||!s)return!1;oe(t.throttle,t.id);const r=t.id||e;return await ae(r,t.throttle,s)>0?!0:(await s.set(r,Date.now().toString()),!1)},A=()=>new y(429,"Too Many Requests"),ne=async(e,t,s,r)=>{const o=R(r),l=o.publicKey||n.publicKey,a=o.blockHeadless||n.blockHeadless,h=o.storageProvider||n.storageProvider,v={...n.blockList,...o.blockList},d={...n.limitRate,...o.limitRate};return a&&V(navigator)?Promise.reject(H()):(T(l,e,t),te(s),s&&B(v,s)?Promise.reject(O()):await D(location.pathname,d,h)?Promise.reject(A()):I("/api/v1.0/email/send",JSON.stringify({lib_version:"4.4.1",user_id:l,service_id:e,template_id:t,template_params:s}),{"Content-type":"application/json"}))},le=e=>{if(!e||e.nodeName!=="FORM")throw"The 3rd parameter is expected to be the HTML form element or the style selector of the form"},ce=e=>typeof e=="string"?document.querySelector(e):e,de=async(e,t,s,r)=>{const o=R(r),l=o.publicKey||n.publicKey,a=o.blockHeadless||n.blockHeadless,h=n.storageProvider||o.storageProvider,v={...n.blockList,...o.blockList},d={...n.limitRate,...o.limitRate};if(a&&V(navigator))return Promise.reject(H());const f=ce(s);T(l,e,t),le(f);const u=new FormData(f);return B(v,u)?Promise.reject(O()):await D(location.pathname,d,h)?Promise.reject(A()):(u.append("lib_version","4.4.1"),u.append("service_id",e),u.append("template_id",t),u.append("user_id",l),I("/api/v1.0/email/send-form",u))},pe={init:ee,send:ne,sendForm:de,EmailJSResponseStatus:y},F="hcaptcha-api-script-id",K="_hcaptchaOnLoad";let E,q;const C=new Promise((e,t)=>{E=e,q=t});function he(e){if(window.hcaptcha)return E(),C;if(document.getElementById(F))return C;window[K]=E;const t=ue(e),s=document.createElement("script");return s.id=F,s.src=t,s.async=!0,s.defer=!0,s.onerror=r=>{console.error("Failed to load api: "+t,r),q("Failed to load api.js")},document.head.appendChild(s),C}function ue(e){let t=e.apiEndpoint;return t=p(t,"render","explicit"),t=p(t,"onload",K),t=p(t,"recaptchacompat",e.reCaptchaCompat===!1?"off":null),t=p(t,"hl",e.language),t=p(t,"sentry",e.sentry),t=p(t,"custom",e.custom),t=p(t,"endpoint",e.endpoint),t=p(t,"assethost",e.assethost),t=p(t,"imghost",e.imghost),t=p(t,"reportapi",e.reportapi),t}function p(e,t,s){if(s!=null){const r=e.includes("?")?"&":"?";return e+r+t+"="+encodeURIComponent(s)}return e}var me=(e,t)=>{for(const[s,r]of t)e[s]=r;return e};const fe={name:"VueHcaptcha",props:{sitekey:{type:String,required:!0},theme:{type:String,default:void 0},size:{type:String,default:void 0},tabindex:{type:String,default:void 0},language:{type:String,default:void 0},reCaptchaCompat:{type:Boolean,default:!0},challengeContainer:{type:String,default:void 0},rqdata:{type:String,default:void 0},sentry:{type:Boolean,default:!0},custom:{type:Boolean,default:void 0},apiEndpoint:{type:String,default:"https://hcaptcha.com/1/api.js"},endpoint:{type:String,default:void 0},reportapi:{type:String,default:void 0},assethost:{type:String,default:void 0},imghost:{type:String,default:void 0}},data:()=>({widgetId:null,hcaptcha:null,renderedCb:null}),mounted(){return he(this.$props).then(this.onApiLoaded).catch(this.onError)},unmounted(){this.teardown()},destroyed(){this.teardown()},methods:{teardown(){this.widgetId&&(this.hcaptcha.reset(this.widgetId),this.hcaptcha.remove(this.widgetId))},onApiLoaded(){this.hcaptcha=window.hcaptcha;const e={sitekey:this.sitekey,theme:this.theme,size:this.size,tabindex:this.tabindex,callback:this.onVerify,"expired-callback":this.onExpired,"chalexpired-callback":this.onChallengeExpired,"error-callback":this.onError,"open-callback":this.onOpen,"close-callback":this.onClose};this.challengeContainer&&(e["challenge-container"]=this.challengeContainer),this.widgetId=this.hcaptcha.render(this.$el,e),this.rqdata&&this.hcaptcha.setData(this.widgetId,{rqdata:this.rqdata}),this.onRendered()},execute(){this.widgetId?(this.hcaptcha.execute(this.widgetId),this.onExecuted()):this.renderedCb=()=>{this.renderedCb=null,this.execute()}},executeAsync(){if(this.widgetId)return this.onExecuted(),this.hcaptcha.execute(this.widgetId,{async:!0});let e;const t=new Promise(s=>{e=s});return this.renderedCb=()=>{this.renderedCb=null,e()},t.then(this.executeAsync)},reset(){this.widgetId?(this.hcaptcha.reset(this.widgetId),this.onReset()):this.$emit("error","Element is not rendered yet and thus cannot reset it. Wait for `rendered` event to safely call reset.")},onRendered(){this.$emit("rendered"),this.renderedCb&&this.renderedCb()},onExecuted(){this.$emit("executed")},onReset(){this.$emit("reset")},onError(e){this.$emit("error",e),this.reset()},onVerify(){const e=this.hcaptcha.getResponse(this.widgetId),t=this.hcaptcha.getRespKey(this.widgetId);this.$emit("verify",e,t)},onExpired(){this.$emit("expired")},onChallengeExpired(){this.$emit("challengeExpired")},onOpen(){this.$emit("opened")},onClose(){this.$emit("closed")}}},ge={id:"hcap-script"};function be(e,t,s,r,o,l){return b(),g("div",ge)}var ve=me(fe,[["render",be]]);const ye=$({__name:"FormPopup",setup(e,{expose:t}){t();const s=m(!1),r=m(!1),o=m(!1),l=m(""),a=m(null),h=m(null),v="d9b2e78c-9f48-4190-9754-170e4866054e",d=m({name:"",phone:"",message:"",agree:!0});function f(){s.value=!0,r.value=!1,l.value="",d.value.name="",d.value.phone="",d.value.message="",d.value.agree=!0}function u(){s.value=!1}function M(x){let c=x.target.value.replace(/\D/g,"");c.length>0&&(c="+"+c),c.length>2&&(c=c.slice(0,2)+" ("+c.slice(2)),c.length>7&&(c=c.slice(0,7)+") "+c.slice(7)),c.length>12&&(c=c.slice(0,12)+"-"+c.slice(12,16)),d.value.phone=c}async function N(x){if(a.value){o.value=!0,l.value="";try{new FormData(a.value).append("h-captcha-response",x),await pe.sendForm("service_xoyw1bs","template_24xrd1c",a.value,"QYVFG3lrU2_gp6O9u"),r.value=!0,a.value.reset(),h.value.reset()}catch(w){l.value=`❌ Ошибка: ${w.text||w.message}`}finally{o.value=!1}}}function U(){if(!d.value.agree){l.value="⚠️ Пожалуйста, дайте согласие на обработку данных";return}h.value&&(console.log("here"),h.value.execute())}const _=()=>f();G(()=>{window.addEventListener("open-contact-popup",_)}),Y(()=>{window.removeEventListener("open-contact-popup",_)});const L={isOpen:s,success:r,loading:o,status:l,formRef:a,hcaptchaRef:h,siteKey:v,form:d,openPopup:f,closePopup:u,formatPhone:M,sendEmail:N,submitForm:U,handleOpen:_,get VueHcaptcha(){return ve}};return Object.defineProperty(L,"__isScriptSetup",{enumerable:!1,value:!0}),L}}),we={class:"popup"},ke={key:0,class:"success-state"},_e={class:"custom-checkbox"},xe=["disabled"],Pe={key:0,class:"spinner"},Se={key:1},Ce={class:"status"};function Ee(e,t,s,r,o,l){return b(),g("div",{class:W(["popup-overlay",{active:r.isOpen}]),onClick:j(r.closePopup,["self"])},[i("div",we,[i("button",{class:"popup-close-btn",onClick:r.closePopup,"aria-label":"Close"},t[4]||(t[4]=[i("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"3","stroke-linecap":"round","stroke-linejoin":"round"},[i("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),i("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)])),r.success?(b(),g("div",ke,t[5]||(t[5]=[i("svg",{xmlns:"http://www.w3.org/2000/svg",class:"tick",viewBox:"0 0 24 24"},[i("path",{fill:"none",stroke:"green","stroke-width":"3",d:"M5 13l4 4L19 7"})],-1),i("h2",null,"Спасибо за вашу заявку!",-1),i("p",null,"Свяжемся с вами в ближайшее время.",-1)]))):(b(),g("form",{key:1,ref:"formRef",onSubmit:j(r.submitForm,["prevent"])},[J(r.VueHcaptcha,{ref:"hcaptchaRef",sitekey:r.siteKey,size:"invisible",theme:"dark",onVerify:r.sendEmail},null,8,["sitekey"]),t[8]||(t[8]=i("h2",null,"Получите консультацию и запланируйте замер. Бесплатно!",-1)),k(i("input",{"onUpdate:modelValue":t[0]||(t[0]=a=>r.form.name=a),type:"text",name:"name",placeholder:"Ваше имя",required:""},null,512),[[P,r.form.name]]),k(i("input",{"onUpdate:modelValue":t[1]||(t[1]=a=>r.form.phone=a),type:"tel",name:"phone",placeholder:"+7 (___) ___-____",onInput:r.formatPhone,required:""},null,544),[[P,r.form.phone]]),k(i("textarea",{"onUpdate:modelValue":t[2]||(t[2]=a=>r.form.message=a),name:"message",placeholder:"Комментарий"},null,512),[[P,r.form.message]]),i("label",_e,[k(i("input",{type:"checkbox",checked:"","onUpdate:modelValue":t[3]||(t[3]=a=>r.form.agree=a)},null,512),[[z,r.form.agree]]),t[6]||(t[6]=i("span",{class:"checkmark"},null,-1)),t[7]||(t[7]=i("span",null,[S(" Я даю свое согласие на обработку "),i("a",{href:"/terms",target:"_blank",class:"link underline","aria-label":"Узнать больше об условиях использования"},"персональных данных"),S(" и соглашаюсь с условиями и "),i("a",{href:"/privacy-policy",target:"_blank",class:"link underline","aria-label":"Узнать больше о политике конфиденциальности"},"политикой конфиденциальности"),S(".")],-1))]),i("button",{type:"submit",disabled:r.loading},[r.loading?(b(),g("span",Pe)):(b(),g("span",Se,"Отправить"))],8,xe),i("p",Ce,Q(r.status),1)],544))])],2)}const Ie=X(ye,[["render",Ee],["__scopeId","data-v-a4ce2603"]]);export{Ie as default};
