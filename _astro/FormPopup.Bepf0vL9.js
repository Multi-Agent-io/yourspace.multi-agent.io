import{w as j,v as _,a as O}from"./runtime-dom.esm-bundler.BakF-axo.js";/* empty css                          */import{_ as M}from"./_plugin-vue_export-helper.DlAUqK2U.js";import{d as C,c as b,a as r,w as y,b as P,t as K,n as q,r as p,e as D,f as N,o as g}from"./runtime-core.esm-bundler.BxC9eJsW.js";class v{constructor(t=0,s="Network Error"){this.status=t,this.text=s}}const U=()=>{if(!(typeof localStorage>"u"))return{get:e=>Promise.resolve(localStorage.getItem(e)),set:(e,t)=>Promise.resolve(localStorage.setItem(e,t)),remove:e=>Promise.resolve(localStorage.removeItem(e))}},n={origin:"https://api.emailjs.com",blockHeadless:!1,storageProvider:U()},x=e=>e?typeof e=="string"?{publicKey:e}:e.toString()==="[object Object]"?e:{}:{},I=(e,t="https://api.emailjs.com")=>{if(!e)return;const s=x(e);n.publicKey=s.publicKey,n.blockHeadless=s.blockHeadless,n.storageProvider=s.storageProvider,n.blockList=s.blockList,n.limitRate=s.limitRate,n.origin=s.origin||t},T=async(e,t,s={})=>{const o=await fetch(n.origin+e,{method:"POST",headers:s,body:t}),a=await o.text(),l=new v(o.status,a);if(o.ok)return l;throw l},R=(e,t,s)=>{if(!e||typeof e!="string")throw"The public key is required. Visit https://dashboard.emailjs.com/admin/account";if(!t||typeof t!="string")throw"The service ID is required. Visit https://dashboard.emailjs.com/admin";if(!s||typeof s!="string")throw"The template ID is required. Visit https://dashboard.emailjs.com/admin/templates"},A=e=>{if(e&&e.toString()!=="[object Object]")throw"The template params have to be the object. Visit https://www.emailjs.com/docs/sdk/send/"},S=e=>e.webdriver||!e.languages||e.languages.length===0,V=()=>new v(451,"Unavailable For Headless Browser"),J=(e,t)=>{if(!Array.isArray(e))throw"The BlockList list has to be an array";if(typeof t!="string")throw"The BlockList watchVariable has to be a string"},z=e=>!e.list?.length||!e.watchVariable,W=(e,t)=>e instanceof FormData?e.get(t):e[t],H=(e,t)=>{if(z(e))return!1;J(e.list,e.watchVariable);const s=W(t,e.watchVariable);return typeof s!="string"?!1:e.list.includes(s)},F=()=>new v(403,"Forbidden"),G=(e,t)=>{if(typeof e!="number"||e<0)throw"The LimitRate throttle has to be a positive number";if(t&&typeof t!="string")throw"The LimitRate ID has to be a non-empty string"},Q=async(e,t,s)=>{const o=Number(await s.get(e)||0);return t-Date.now()+o},B=async(e,t,s)=>{if(!t.throttle||!s)return!1;G(t.throttle,t.id);const o=t.id||e;return await Q(o,t.throttle,s)>0?!0:(await s.set(o,Date.now().toString()),!1)},E=()=>new v(429,"Too Many Requests"),X=async(e,t,s,o)=>{const a=x(o),l=a.publicKey||n.publicKey,c=a.blockHeadless||n.blockHeadless,u=a.storageProvider||n.storageProvider,m={...n.blockList,...a.blockList},f={...n.limitRate,...a.limitRate};return c&&S(navigator)?Promise.reject(V()):(R(l,e,t),A(s),s&&H(m,s)?Promise.reject(F()):await B(location.pathname,f,u)?Promise.reject(E()):T("/api/v1.0/email/send",JSON.stringify({lib_version:"4.4.1",user_id:l,service_id:e,template_id:t,template_params:s}),{"Content-type":"application/json"}))},Y=e=>{if(!e||e.nodeName!=="FORM")throw"The 3rd parameter is expected to be the HTML form element or the style selector of the form"},Z=e=>typeof e=="string"?document.querySelector(e):e,$=async(e,t,s,o)=>{const a=x(o),l=a.publicKey||n.publicKey,c=a.blockHeadless||n.blockHeadless,u=n.storageProvider||a.storageProvider,m={...n.blockList,...a.blockList},f={...n.limitRate,...a.limitRate};if(c&&S(navigator))return Promise.reject(V());const h=Z(s);R(l,e,t),Y(h);const d=new FormData(h);return H(m,d)?Promise.reject(F()):await B(location.pathname,f,u)?Promise.reject(E()):(d.append("lib_version","4.4.1"),d.append("service_id",e),d.append("template_id",t),d.append("user_id",l),T("/api/v1.0/email/send-form",d))},ee={init:I,send:X,sendForm:$,EmailJSResponseStatus:v},te=C({__name:"FormPopup",setup(e,{expose:t}){t();const s=p(!1),o=p(!1),a=p(!1),l=p(""),c=p(null),u=p({name:"",phone:"",message:"",agree:!0});function m(){s.value=!0,o.value=!1,l.value="",u.value.name="",u.value.phone="",u.value.message="",u.value.agree=!0}function f(){s.value=!1}function h(w){let i=w.target.value.replace(/\D/g,"");i.length>0&&(i="+"+i),i.length>2&&(i=i.slice(0,2)+" ("+i.slice(2)),i.length>7&&(i=i.slice(0,7)+") "+i.slice(7)),i.length>12&&(i=i.slice(0,12)+"-"+i.slice(12,16)),u.value.phone=i}async function d(){if(c.value){if(a.value=!0,l.value="",!u.value.agree){l.value="⚠️ Необходимо согласие на обработку данных для отправки формы.",a.value=!1;return}try{await ee.sendForm(void 0,void 0,c.value,void 0),o.value=!0}catch(w){l.value=`❌ Failed to send: ${w.text||w.message}`}finally{a.value=!1}}}const k=()=>m();D(()=>{window.addEventListener("open-contact-popup",k)}),N(()=>{window.removeEventListener("open-contact-popup",k)});const L={isOpen:s,success:o,loading:a,status:l,formRef:c,form:u,openPopup:m,closePopup:f,formatPhone:h,sendEmail:d,handleOpen:k};return Object.defineProperty(L,"__isScriptSetup",{enumerable:!1,value:!0}),L}}),se={class:"popup"},oe={key:0,class:"success-state"},re={class:"custom-checkbox"},ae=["disabled"],ne={key:0,class:"spinner"},ie={key:1},le={class:"status"};function ce(e,t,s,o,a,l){return g(),b("div",{class:q(["popup-overlay",{active:o.isOpen}]),onClick:j(o.closePopup,["self"])},[r("div",se,[r("button",{class:"popup-close-btn",onClick:o.closePopup,"aria-label":"Close"},t[4]||(t[4]=[r("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"3","stroke-linecap":"round","stroke-linejoin":"round"},[r("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),r("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)])),o.success?(g(),b("div",oe,t[5]||(t[5]=[r("svg",{xmlns:"http://www.w3.org/2000/svg",class:"tick",viewBox:"0 0 24 24"},[r("path",{fill:"none",stroke:"green","stroke-width":"3",d:"M5 13l4 4L19 7"})],-1),r("h2",null,"Спасибо за вашу заявку!",-1),r("p",null,"Свяжемся с вами в ближайшее время.",-1)]))):(g(),b("form",{key:1,ref:"formRef",onSubmit:j(o.sendEmail,["prevent"])},[t[8]||(t[8]=r("h2",null,"Получите консультацию и запланируйте замер. Бесплатно!",-1)),y(r("input",{"onUpdate:modelValue":t[0]||(t[0]=c=>o.form.name=c),type:"text",name:"name",placeholder:"Ваше имя",required:""},null,512),[[_,o.form.name]]),y(r("input",{"onUpdate:modelValue":t[1]||(t[1]=c=>o.form.phone=c),type:"tel",name:"phone",placeholder:"+7 (___) ___-____",onInput:o.formatPhone,required:""},null,544),[[_,o.form.phone]]),y(r("textarea",{"onUpdate:modelValue":t[2]||(t[2]=c=>o.form.message=c),name:"message",placeholder:"Комментарий"},null,512),[[_,o.form.message]]),r("label",re,[y(r("input",{type:"checkbox",checked:"","onUpdate:modelValue":t[3]||(t[3]=c=>o.form.agree=c)},null,512),[[O,o.form.agree]]),t[6]||(t[6]=r("span",{class:"checkmark"},null,-1)),t[7]||(t[7]=r("span",null,[P(" Я даю свое согласие на обработку "),r("a",{href:"/terms",target:"_blank",class:"link underline","aria-label":"Узнать больше об условиях использования"},"персональных данных"),P(" и соглашаюсь с условиями и "),r("a",{href:"/privacy-policy",target:"_blank",class:"link underline","aria-label":"Узнать больше о политике конфиденциальности"},"политикой конфиденциальности"),P(".")],-1))]),r("button",{type:"submit",disabled:o.loading},[o.loading?(g(),b("span",ne)):(g(),b("span",ie,"Отправить"))],8,ae),r("p",le,K(o.status),1)],544))])],2)}const he=M(te,[["render",ce],["__scopeId","data-v-cfa37218"]]);export{he as default};
