import{w as F,v as S,a as $}from"./runtime-dom.esm-bundler.BEzqyxp1.js";import{c as v,o as y,d as J,a,b as Q,w as _,e as C,t as G,n as Y,r as f,f as X,g as Z}from"./runtime-core.esm-bundler.mmfGiYl5.js";/* empty css                          */import{_ as ee}from"./_plugin-vue_export-helper.DlAUqK2U.js";class k{constructor(t=0,s="Network Error"){this.status=t,this.text=s}}const te=()=>{if(!(typeof localStorage>"u"))return{get:e=>Promise.resolve(localStorage.getItem(e)),set:(e,t)=>Promise.resolve(localStorage.setItem(e,t)),remove:e=>Promise.resolve(localStorage.removeItem(e))}},l={origin:"https://api.emailjs.com",blockHeadless:!1,storageProvider:te()},L=e=>e?typeof e=="string"?{publicKey:e}:e.toString()==="[object Object]"?e:{}:{},se=(e,t="https://api.emailjs.com")=>{if(!e)return;const s=L(e);l.publicKey=s.publicKey,l.blockHeadless=s.blockHeadless,l.storageProvider=s.storageProvider,l.blockList=s.blockList,l.limitRate=s.limitRate,l.origin=s.origin||t},T=async(e,t,s={})=>{const i=await fetch(l.origin+e,{method:"POST",headers:s,body:t}),o=await i.text(),c=new k(i.status,o);if(i.ok)return c;throw c},V=(e,t,s)=>{if(!e||typeof e!="string")throw"The public key is required. Visit https://dashboard.emailjs.com/admin/account";if(!t||typeof t!="string")throw"The service ID is required. Visit https://dashboard.emailjs.com/admin";if(!s||typeof s!="string")throw"The template ID is required. Visit https://dashboard.emailjs.com/admin/templates"},ie=e=>{if(e&&e.toString()!=="[object Object]")throw"The template params have to be the object. Visit https://www.emailjs.com/docs/sdk/send/"},H=e=>e.webdriver||!e.languages||e.languages.length===0,B=()=>new k(451,"Unavailable For Headless Browser"),re=(e,t)=>{if(!Array.isArray(e))throw"The BlockList list has to be an array";if(typeof t!="string")throw"The BlockList watchVariable has to be a string"},ae=e=>!e.list?.length||!e.watchVariable,oe=(e,t)=>e instanceof FormData?e.get(t):e[t],O=(e,t)=>{if(ae(e))return!1;re(e.list,e.watchVariable);const s=oe(t,e.watchVariable);return typeof s!="string"?!1:e.list.includes(s)},D=()=>new k(403,"Forbidden"),ne=(e,t)=>{if(typeof e!="number"||e<0)throw"The LimitRate throttle has to be a positive number";if(t&&typeof t!="string")throw"The LimitRate ID has to be a non-empty string"},le=async(e,t,s)=>{const i=Number(await s.get(e)||0);return t-Date.now()+i},q=async(e,t,s)=>{if(!t.throttle||!s)return!1;ne(t.throttle,t.id);const i=t.id||e;return await le(i,t.throttle,s)>0?!0:(await s.set(i,Date.now().toString()),!1)},A=()=>new k(429,"Too Many Requests"),ce=async(e,t,s,i)=>{const o=L(i),c=o.publicKey||l.publicKey,n=o.blockHeadless||l.blockHeadless,u=o.storageProvider||l.storageProvider,w={...l.blockList,...o.blockList},h={...l.limitRate,...o.limitRate};return n&&H(navigator)?Promise.reject(B()):(V(c,e,t),ie(s),s&&O(w,s)?Promise.reject(D()):await q(location.pathname,h,u)?Promise.reject(A()):T("/api/v1.0/email/send",JSON.stringify({lib_version:"4.4.1",user_id:c,service_id:e,template_id:t,template_params:s}),{"Content-type":"application/json"}))},de=e=>{if(!e||e.nodeName!=="FORM")throw"The 3rd parameter is expected to be the HTML form element or the style selector of the form"},he=e=>typeof e=="string"?document.querySelector(e):e,pe=async(e,t,s,i)=>{const o=L(i),c=o.publicKey||l.publicKey,n=o.blockHeadless||l.blockHeadless,u=l.storageProvider||o.storageProvider,w={...l.blockList,...o.blockList},h={...l.limitRate,...o.limitRate};if(n&&H(navigator))return Promise.reject(B());const g=he(s);V(c,e,t),de(g);const m=new FormData(g);return O(w,m)?Promise.reject(D()):await q(location.pathname,h,u)?Promise.reject(A()):(m.append("lib_version","4.4.1"),m.append("service_id",e),m.append("template_id",t),m.append("user_id",c),T("/api/v1.0/email/send-form",m))},ue={init:se,send:ce,sendForm:pe,EmailJSResponseStatus:k},I="hcaptcha-api-script-id",K="_hcaptchaOnLoad";let R,M;const E=new Promise((e,t)=>{R=e,M=t});function me(e){if(window.hcaptcha)return R(),E;if(document.getElementById(I))return E;window[K]=R;const t=fe(e),s=document.createElement("script");return s.id=I,s.src=t,s.async=!0,s.defer=!0,s.onerror=i=>{console.error("Failed to load api: "+t,i),M("Failed to load api.js")},document.head.appendChild(s),E}function fe(e){let t=e.apiEndpoint;return t=p(t,"render","explicit"),t=p(t,"onload",K),t=p(t,"recaptchacompat",e.reCaptchaCompat===!1?"off":null),t=p(t,"hl",e.language),t=p(t,"sentry",e.sentry),t=p(t,"custom",e.custom),t=p(t,"endpoint",e.endpoint),t=p(t,"assethost",e.assethost),t=p(t,"imghost",e.imghost),t=p(t,"reportapi",e.reportapi),t}function p(e,t,s){if(s!=null){const i=e.includes("?")?"&":"?";return e+i+t+"="+encodeURIComponent(s)}return e}var ge=(e,t)=>{for(const[s,i]of t)e[s]=i;return e};const be={name:"VueHcaptcha",props:{sitekey:{type:String,required:!0},theme:{type:String,default:void 0},size:{type:String,default:void 0},tabindex:{type:String,default:void 0},language:{type:String,default:void 0},reCaptchaCompat:{type:Boolean,default:!0},challengeContainer:{type:String,default:void 0},rqdata:{type:String,default:void 0},sentry:{type:Boolean,default:!0},custom:{type:Boolean,default:void 0},apiEndpoint:{type:String,default:"https://hcaptcha.com/1/api.js"},endpoint:{type:String,default:void 0},reportapi:{type:String,default:void 0},assethost:{type:String,default:void 0},imghost:{type:String,default:void 0}},data:()=>({widgetId:null,hcaptcha:null,renderedCb:null}),mounted(){return me(this.$props).then(this.onApiLoaded).catch(this.onError)},unmounted(){this.teardown()},destroyed(){this.teardown()},methods:{teardown(){this.widgetId&&(this.hcaptcha.reset(this.widgetId),this.hcaptcha.remove(this.widgetId))},onApiLoaded(){this.hcaptcha=window.hcaptcha;const e={sitekey:this.sitekey,theme:this.theme,size:this.size,tabindex:this.tabindex,callback:this.onVerify,"expired-callback":this.onExpired,"chalexpired-callback":this.onChallengeExpired,"error-callback":this.onError,"open-callback":this.onOpen,"close-callback":this.onClose};this.challengeContainer&&(e["challenge-container"]=this.challengeContainer),this.widgetId=this.hcaptcha.render(this.$el,e),this.rqdata&&this.hcaptcha.setData(this.widgetId,{rqdata:this.rqdata}),this.onRendered()},execute(){this.widgetId?(this.hcaptcha.execute(this.widgetId),this.onExecuted()):this.renderedCb=()=>{this.renderedCb=null,this.execute()}},executeAsync(){if(this.widgetId)return this.onExecuted(),this.hcaptcha.execute(this.widgetId,{async:!0});let e;const t=new Promise(s=>{e=s});return this.renderedCb=()=>{this.renderedCb=null,e()},t.then(this.executeAsync)},reset(){this.widgetId?(this.hcaptcha.reset(this.widgetId),this.onReset()):this.$emit("error","Element is not rendered yet and thus cannot reset it. Wait for `rendered` event to safely call reset.")},onRendered(){this.$emit("rendered"),this.renderedCb&&this.renderedCb()},onExecuted(){this.$emit("executed")},onReset(){this.$emit("reset")},onError(e){this.$emit("error",e),this.reset()},onVerify(){const e=this.hcaptcha.getResponse(this.widgetId),t=this.hcaptcha.getRespKey(this.widgetId);this.$emit("verify",e,t)},onExpired(){this.$emit("expired")},onChallengeExpired(){this.$emit("challengeExpired")},onOpen(){this.$emit("opened")},onClose(){this.$emit("closed")}}},ve={id:"hcap-script"};function ye(e,t,s,i,o,c){return y(),v("div",ve)}var we=ge(be,[["render",ye]]);const ke=J({__name:"FormPopup",setup(e,{expose:t}){t();const s=f(!1),i=f(!1),o=f(!1),c=f(""),n=f(null),u=f(null),w="d9b2e78c-9f48-4190-9754-170e4866054e",h=f({name:"",phone:"",message:"",agree:!1});function g(){s.value=!0,i.value=!1,c.value="",h.value.name="",h.value.phone="",h.value.message="",h.value.agree=!1}function m(){s.value=!1}function N(P){let b=P.target.value;const z=b.startsWith("+");let r=b.replace(/\D/g,""),d="";z?(d="+",r.startsWith("7")&&(r=r.slice(1),d+="7",r.length>0&&(d+=" ("+r.slice(0,3)),r.length>=4&&(d+=") "+r.slice(3,6)),r.length>=7&&(d+="-"+r.slice(6,8)),r.length>=9&&(d+="-"+r.slice(8,10)))):(r.startsWith("8")?r="7"+r.slice(1):r.startsWith("9")?r="79"+r.slice(1):r.startsWith("7")||(r="7"+r),d="+7",r.length>1&&(d+=" ("+r.slice(1,4)),r.length>=5&&(d+=") "+r.slice(4,7)),r.length>=8&&(d+="-"+r.slice(7,9)),r.length>=10&&(d+="-"+r.slice(9,11))),h.value.phone=d}async function U(P){if(n.value){o.value=!0,c.value="";try{new FormData(n.value).append("h-captcha-response",P),await ue.sendForm("service_wq0jqrd","template_24xrd1c",n.value,"QYVFG3lrU2_gp6O9u"),i.value=!0,n.value.reset(),u.value.reset()}catch(b){c.value=`❌ Ошибка: ${b.text||b.message}`}finally{o.value=!1}}}function W(){if(!h.value.agree){c.value="⚠️ Пожалуйста, дайте согласие на обработку данных";return}u.value&&u.value.execute()}const x=()=>g();X(()=>{window.addEventListener("open-contact-popup",x)}),Z(()=>{window.removeEventListener("open-contact-popup",x)});const j={isOpen:s,success:i,loading:o,status:c,formRef:n,hcaptchaRef:u,siteKey:w,form:h,openPopup:g,closePopup:m,formatPhone:N,sendEmail:U,submitForm:W,handleOpen:x,get VueHcaptcha(){return we}};return Object.defineProperty(j,"__isScriptSetup",{enumerable:!1,value:!0}),j}}),_e={class:"popup"},xe={key:0,class:"success-state"},Pe={class:"custom-checkbox"},Se=["disabled"],Ce={key:0,class:"spinner"},Ee={key:1},Re={class:"status"};function Le(e,t,s,i,o,c){return y(),v("div",{class:Y(["popup-overlay",{active:i.isOpen}]),onClick:F(i.closePopup,["self"])},[a("div",_e,[a("button",{class:"popup-close-btn",onClick:i.closePopup,"aria-label":"Close"},t[4]||(t[4]=[a("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"3","stroke-linecap":"round","stroke-linejoin":"round"},[a("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),a("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)])),i.success?(y(),v("div",xe,t[5]||(t[5]=[a("svg",{xmlns:"http://www.w3.org/2000/svg",class:"tick",viewBox:"0 0 24 24"},[a("path",{fill:"none",stroke:"green","stroke-width":"3",d:"M5 13l4 4L19 7"})],-1),a("h2",null,"Спасибо за вашу заявку!",-1),a("p",null,"Свяжемся с вами в ближайшее время.",-1)]))):(y(),v("form",{key:1,ref:"formRef",onSubmit:F(i.submitForm,["prevent"])},[Q(i.VueHcaptcha,{ref:"hcaptchaRef",sitekey:i.siteKey,size:"invisible",theme:"dark",onVerify:i.sendEmail},null,8,["sitekey"]),t[8]||(t[8]=a("h2",null,"Получите консультацию и запланируйте замер. Бесплатно!",-1)),_(a("input",{"onUpdate:modelValue":t[0]||(t[0]=n=>i.form.name=n),type:"text",name:"name",placeholder:"Ваше имя",required:""},null,512),[[S,i.form.name]]),_(a("input",{"onUpdate:modelValue":t[1]||(t[1]=n=>i.form.phone=n),type:"tel",name:"phone",placeholder:"+7 (___) ___-____",onInput:i.formatPhone,required:""},null,544),[[S,i.form.phone]]),_(a("textarea",{"onUpdate:modelValue":t[2]||(t[2]=n=>i.form.message=n),name:"message",placeholder:"Комментарий"},null,512),[[S,i.form.message]]),a("label",Pe,[_(a("input",{type:"checkbox","onUpdate:modelValue":t[3]||(t[3]=n=>i.form.agree=n)},null,512),[[$,i.form.agree]]),t[6]||(t[6]=a("span",{class:"checkmark"},null,-1)),t[7]||(t[7]=a("span",null,[C(" Я даю свое согласие на обработку "),a("a",{href:"/terms",target:"_blank",class:"link underline","aria-label":"Узнать больше об условиях использования"},"персональных данных"),C(" и соглашаюсь с условиями и "),a("a",{href:"/privacy-policy",target:"_blank",class:"link underline","aria-label":"Узнать больше о политике конфиденциальности"},"политикой конфиденциальности"),C(".")],-1))]),a("button",{type:"submit",disabled:i.loading||!i.form.agree},[i.loading?(y(),v("span",Ce)):(y(),v("span",Ee,"Отправить"))],8,Se),a("p",Re,G(i.status),1)],544))])],2)}const Ve=ee(ke,[["render",Le],["__scopeId","data-v-7860b906"]]);export{Ve as default};
