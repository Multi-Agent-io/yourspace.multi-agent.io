import{w as F,v as S,a as z}from"./runtime-dom.esm-bundler.BEzqyxp1.js";import{c as g,o as v,d as $,a as i,b as J,w as _,e as C,t as Q,n as G,r as m,f as Y,g as X}from"./runtime-core.esm-bundler.mmfGiYl5.js";/* empty css                          */import{_ as Z}from"./_plugin-vue_export-helper.DlAUqK2U.js";class w{constructor(t=0,s="Network Error"){this.status=t,this.text=s}}const ee=()=>{if(!(typeof localStorage>"u"))return{get:e=>Promise.resolve(localStorage.getItem(e)),set:(e,t)=>Promise.resolve(localStorage.setItem(e,t)),remove:e=>Promise.resolve(localStorage.removeItem(e))}},l={origin:"https://api.emailjs.com",blockHeadless:!1,storageProvider:ee()},L=e=>e?typeof e=="string"?{publicKey:e}:e.toString()==="[object Object]"?e:{}:{},te=(e,t="https://api.emailjs.com")=>{if(!e)return;const s=L(e);l.publicKey=s.publicKey,l.blockHeadless=s.blockHeadless,l.storageProvider=s.storageProvider,l.blockList=s.blockList,l.limitRate=s.limitRate,l.origin=s.origin||t},T=async(e,t,s={})=>{const r=await fetch(l.origin+e,{method:"POST",headers:s,body:t}),a=await r.text(),c=new w(r.status,a);if(r.ok)return c;throw c},V=(e,t,s)=>{if(!e||typeof e!="string")throw"The public key is required. Visit https://dashboard.emailjs.com/admin/account";if(!t||typeof t!="string")throw"The service ID is required. Visit https://dashboard.emailjs.com/admin";if(!s||typeof s!="string")throw"The template ID is required. Visit https://dashboard.emailjs.com/admin/templates"},se=e=>{if(e&&e.toString()!=="[object Object]")throw"The template params have to be the object. Visit https://www.emailjs.com/docs/sdk/send/"},H=e=>e.webdriver||!e.languages||e.languages.length===0,B=()=>new w(451,"Unavailable For Headless Browser"),re=(e,t)=>{if(!Array.isArray(e))throw"The BlockList list has to be an array";if(typeof t!="string")throw"The BlockList watchVariable has to be a string"},ie=e=>!e.list?.length||!e.watchVariable,ae=(e,t)=>e instanceof FormData?e.get(t):e[t],O=(e,t)=>{if(ie(e))return!1;re(e.list,e.watchVariable);const s=ae(t,e.watchVariable);return typeof s!="string"?!1:e.list.includes(s)},D=()=>new w(403,"Forbidden"),oe=(e,t)=>{if(typeof e!="number"||e<0)throw"The LimitRate throttle has to be a positive number";if(t&&typeof t!="string")throw"The LimitRate ID has to be a non-empty string"},ne=async(e,t,s)=>{const r=Number(await s.get(e)||0);return t-Date.now()+r},q=async(e,t,s)=>{if(!t.throttle||!s)return!1;oe(t.throttle,t.id);const r=t.id||e;return await ne(r,t.throttle,s)>0?!0:(await s.set(r,Date.now().toString()),!1)},A=()=>new w(429,"Too Many Requests"),le=async(e,t,s,r)=>{const a=L(r),c=a.publicKey||l.publicKey,n=a.blockHeadless||l.blockHeadless,p=a.storageProvider||l.storageProvider,b={...l.blockList,...a.blockList},d={...l.limitRate,...a.limitRate};return n&&H(navigator)?Promise.reject(B()):(V(c,e,t),se(s),s&&O(b,s)?Promise.reject(D()):await q(location.pathname,d,p)?Promise.reject(A()):T("/api/v1.0/email/send",JSON.stringify({lib_version:"4.4.1",user_id:c,service_id:e,template_id:t,template_params:s}),{"Content-type":"application/json"}))},ce=e=>{if(!e||e.nodeName!=="FORM")throw"The 3rd parameter is expected to be the HTML form element or the style selector of the form"},de=e=>typeof e=="string"?document.querySelector(e):e,he=async(e,t,s,r)=>{const a=L(r),c=a.publicKey||l.publicKey,n=a.blockHeadless||l.blockHeadless,p=l.storageProvider||a.storageProvider,b={...l.blockList,...a.blockList},d={...l.limitRate,...a.limitRate};if(n&&H(navigator))return Promise.reject(B());const f=de(s);V(c,e,t),ce(f);const u=new FormData(f);return O(b,u)?Promise.reject(D()):await q(location.pathname,d,p)?Promise.reject(A()):(u.append("lib_version","4.4.1"),u.append("service_id",e),u.append("template_id",t),u.append("user_id",c),T("/api/v1.0/email/send-form",u))},pe={init:te,send:le,sendForm:he,EmailJSResponseStatus:w},I="hcaptcha-api-script-id",K="_hcaptchaOnLoad";let R,M;const E=new Promise((e,t)=>{R=e,M=t});function ue(e){if(window.hcaptcha)return R(),E;if(document.getElementById(I))return E;window[K]=R;const t=me(e),s=document.createElement("script");return s.id=I,s.src=t,s.async=!0,s.defer=!0,s.onerror=r=>{console.error("Failed to load api: "+t,r),M("Failed to load api.js")},document.head.appendChild(s),E}function me(e){let t=e.apiEndpoint;return t=h(t,"render","explicit"),t=h(t,"onload",K),t=h(t,"recaptchacompat",e.reCaptchaCompat===!1?"off":null),t=h(t,"hl",e.language),t=h(t,"sentry",e.sentry),t=h(t,"custom",e.custom),t=h(t,"endpoint",e.endpoint),t=h(t,"assethost",e.assethost),t=h(t,"imghost",e.imghost),t=h(t,"reportapi",e.reportapi),t}function h(e,t,s){if(s!=null){const r=e.includes("?")?"&":"?";return e+r+t+"="+encodeURIComponent(s)}return e}var fe=(e,t)=>{for(const[s,r]of t)e[s]=r;return e};const ge={name:"VueHcaptcha",props:{sitekey:{type:String,required:!0},theme:{type:String,default:void 0},size:{type:String,default:void 0},tabindex:{type:String,default:void 0},language:{type:String,default:void 0},reCaptchaCompat:{type:Boolean,default:!0},challengeContainer:{type:String,default:void 0},rqdata:{type:String,default:void 0},sentry:{type:Boolean,default:!0},custom:{type:Boolean,default:void 0},apiEndpoint:{type:String,default:"https://hcaptcha.com/1/api.js"},endpoint:{type:String,default:void 0},reportapi:{type:String,default:void 0},assethost:{type:String,default:void 0},imghost:{type:String,default:void 0}},data:()=>({widgetId:null,hcaptcha:null,renderedCb:null}),mounted(){return ue(this.$props).then(this.onApiLoaded).catch(this.onError)},unmounted(){this.teardown()},destroyed(){this.teardown()},methods:{teardown(){this.widgetId&&(this.hcaptcha.reset(this.widgetId),this.hcaptcha.remove(this.widgetId))},onApiLoaded(){this.hcaptcha=window.hcaptcha;const e={sitekey:this.sitekey,theme:this.theme,size:this.size,tabindex:this.tabindex,callback:this.onVerify,"expired-callback":this.onExpired,"chalexpired-callback":this.onChallengeExpired,"error-callback":this.onError,"open-callback":this.onOpen,"close-callback":this.onClose};this.challengeContainer&&(e["challenge-container"]=this.challengeContainer),this.widgetId=this.hcaptcha.render(this.$el,e),this.rqdata&&this.hcaptcha.setData(this.widgetId,{rqdata:this.rqdata}),this.onRendered()},execute(){this.widgetId?(this.hcaptcha.execute(this.widgetId),this.onExecuted()):this.renderedCb=()=>{this.renderedCb=null,this.execute()}},executeAsync(){if(this.widgetId)return this.onExecuted(),this.hcaptcha.execute(this.widgetId,{async:!0});let e;const t=new Promise(s=>{e=s});return this.renderedCb=()=>{this.renderedCb=null,e()},t.then(this.executeAsync)},reset(){this.widgetId?(this.hcaptcha.reset(this.widgetId),this.onReset()):this.$emit("error","Element is not rendered yet and thus cannot reset it. Wait for `rendered` event to safely call reset.")},onRendered(){this.$emit("rendered"),this.renderedCb&&this.renderedCb()},onExecuted(){this.$emit("executed")},onReset(){this.$emit("reset")},onError(e){this.$emit("error",e),this.reset()},onVerify(){const e=this.hcaptcha.getResponse(this.widgetId),t=this.hcaptcha.getRespKey(this.widgetId);this.$emit("verify",e,t)},onExpired(){this.$emit("expired")},onChallengeExpired(){this.$emit("challengeExpired")},onOpen(){this.$emit("opened")},onClose(){this.$emit("closed")}}},ve={id:"hcap-script"};function be(e,t,s,r,a,c){return v(),g("div",ve)}var ye=fe(ge,[["render",be]]);const we=$({__name:"FormPopup",setup(e,{expose:t}){t();const s=m(!1),r=m(!1),a=m(!1),c=m(""),n=m(null),p=m(null),b="d9b2e78c-9f48-4190-9754-170e4866054e",d=m({name:"",phone:"",message:"",agree:!1});function f(){s.value=!0,r.value=!1,c.value="",d.value.name="",d.value.phone="",d.value.message="",d.value.agree=!1}function u(){s.value=!1}function N(P){let o=P.target.value.replace(/\D/g,"");o.startsWith("8")?o="78"+o.slice(1):o.startsWith("9")?o="79"+o.slice(1):o.startsWith("7")||o.startsWith("7")||(o="7"+o);let y="+7";o.length>1&&(y+=" ("+o.slice(1,4)),o.length>=5&&(y+=") "+o.slice(4,7)),o.length>=8&&(y+="-"+o.slice(7,9)),o.length>=10&&(y+="-"+o.slice(9,11)),d.value.phone=y}async function U(P){if(n.value){a.value=!0,c.value="";try{new FormData(n.value).append("h-captcha-response",P),await pe.sendForm("service_wq0jqrd","template_24xrd1c",n.value,"QYVFG3lrU2_gp6O9u"),r.value=!0,n.value.reset(),p.value.reset()}catch(k){c.value=`❌ Ошибка: ${k.text||k.message}`}finally{a.value=!1}}}function W(){if(!d.value.agree){c.value="⚠️ Пожалуйста, дайте согласие на обработку данных";return}p.value&&p.value.execute()}const x=()=>f();Y(()=>{window.addEventListener("open-contact-popup",x)}),X(()=>{window.removeEventListener("open-contact-popup",x)});const j={isOpen:s,success:r,loading:a,status:c,formRef:n,hcaptchaRef:p,siteKey:b,form:d,openPopup:f,closePopup:u,formatPhone:N,sendEmail:U,submitForm:W,handleOpen:x,get VueHcaptcha(){return ye}};return Object.defineProperty(j,"__isScriptSetup",{enumerable:!1,value:!0}),j}}),ke={class:"popup"},_e={key:0,class:"success-state"},xe={class:"custom-checkbox"},Pe=["disabled"],Se={key:0,class:"spinner"},Ce={key:1},Ee={class:"status"};function Re(e,t,s,r,a,c){return v(),g("div",{class:G(["popup-overlay",{active:r.isOpen}]),onClick:F(r.closePopup,["self"])},[i("div",ke,[i("button",{class:"popup-close-btn",onClick:r.closePopup,"aria-label":"Close"},t[4]||(t[4]=[i("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"3","stroke-linecap":"round","stroke-linejoin":"round"},[i("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),i("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)])),r.success?(v(),g("div",_e,t[5]||(t[5]=[i("svg",{xmlns:"http://www.w3.org/2000/svg",class:"tick",viewBox:"0 0 24 24"},[i("path",{fill:"none",stroke:"green","stroke-width":"3",d:"M5 13l4 4L19 7"})],-1),i("h2",null,"Спасибо за вашу заявку!",-1),i("p",null,"Свяжемся с вами в ближайшее время.",-1)]))):(v(),g("form",{key:1,ref:"formRef",onSubmit:F(r.submitForm,["prevent"])},[J(r.VueHcaptcha,{ref:"hcaptchaRef",sitekey:r.siteKey,size:"invisible",theme:"dark",onVerify:r.sendEmail},null,8,["sitekey"]),t[8]||(t[8]=i("h2",null,"Получите консультацию и запланируйте замер. Бесплатно!",-1)),_(i("input",{"onUpdate:modelValue":t[0]||(t[0]=n=>r.form.name=n),type:"text",name:"name",placeholder:"Ваше имя",required:""},null,512),[[S,r.form.name]]),_(i("input",{"onUpdate:modelValue":t[1]||(t[1]=n=>r.form.phone=n),type:"tel",name:"phone",placeholder:"+7 (___) ___-____",onInput:r.formatPhone,required:""},null,544),[[S,r.form.phone]]),_(i("textarea",{"onUpdate:modelValue":t[2]||(t[2]=n=>r.form.message=n),name:"message",placeholder:"Комментарий"},null,512),[[S,r.form.message]]),i("label",xe,[_(i("input",{type:"checkbox","onUpdate:modelValue":t[3]||(t[3]=n=>r.form.agree=n)},null,512),[[z,r.form.agree]]),t[6]||(t[6]=i("span",{class:"checkmark"},null,-1)),t[7]||(t[7]=i("span",null,[C(" Я даю свое согласие на обработку "),i("a",{href:"/terms",target:"_blank",class:"link underline","aria-label":"Узнать больше об условиях использования"},"персональных данных"),C(" и соглашаюсь с условиями и "),i("a",{href:"/privacy-policy",target:"_blank",class:"link underline","aria-label":"Узнать больше о политике конфиденциальности"},"политикой конфиденциальности"),C(".")],-1))]),i("button",{type:"submit",disabled:r.loading||!r.form.agree},[r.loading?(v(),g("span",Se)):(v(),g("span",Ce,"Отправить"))],8,Pe),i("p",Ee,Q(r.status),1)],544))])],2)}const Te=Z(we,[["render",Re],["__scopeId","data-v-38e026ae"]]);export{Te as default};
